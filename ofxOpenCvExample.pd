#N canvas 1341 132 543 306 10;
#X obj 16 15 cnv 15 500 270 empty empty empty 20 12 0 14 #f8fc00 #404040 0;
#X obj 41 25 cnv 15 450 250 empty empty ofxOpenCvExample 40 50 0 30 #00f8fc #f8fc00 0;
#X obj 81 166 ofelia d -k \$0-ofxOpenCvExample;
#A __set if type(window) ~= "userdata" then \; window = ofWindow() \; end \; \; local a = ofelia \; local canvas = ofCanvas(this) \; local clock = ofClock(this \, "setup") \; local colorImage = ofxCvColorImage() \; local grayImage = ofxCvGrayscaleImage() \; local grayBg = ofxCvGrayscaleImage() \; local grayDiff = ofxCvGrayscaleImage() \; local contourFinder = ofxCvContourFinder() \; local videoGrabber = ofVideoGrabber() \; \; function a.new() \; ofWindow.addListener("setup" \, this) \; ofWindow.addListener("update" \, this) \; ofWindow.addListener("draw" \, this) \; ofWindow.addListener("mousePressed" \, this) \; ofWindow.addListener("exit" \, this) \; window:setPosition(30 \, 100) \; window:setSize(700 \, 800) \; if ofWindow.exists then \; clock:delay(0) \; else \; window:create() \; end \; end \; \; function a.free() \; window:destroy() \; ofWindow.removeListener("setup" \, this) \; ofWindow.removeListener("update" \, this) \; ofWindow.removeListener("draw" \, this) \; ofWindow.removeListener("mousePressed" \, this) \; ofWindow.removeListener("exit" \, this) \; end \; \; function a.setup() \; ofSetWindowTitle("ofxOpenCvYolo") \; ofBackground(150 \, 230 \, 255 \, 255) \; ofSetDataPathRoot("data") \; ofFill() \; ofSetLineWidth(5) \; videoGrabber:setup(320 \, 240) \; colorImage:allocate(320 \, 240) \; grayImage:allocate(320 \, 240) \; grayBg:allocate(320 \, 240) \; grayDiff:allocate(320 \, 240) \; end \; \; function a.update() \; videoGrabber:update() \; local bNewFrame = videoGrabber:isFrameNew() \; if (bNewFrame) then \; grayDiff:absDiff(grayBg \, grayImage) \; colorImage:setFromPixels(videoGrabber:getPixels()) \; grayImage:setFromColorImage(colorImage) \; grayDiff:absDiff(grayBg \, grayImage) \; grayDiff:threshold(80) \; contourFinder:findContours(grayDiff \, 20 \, (340*240)/3 \, 10 \, true) \; end \; end \; \; function a.draw() \; colorImage:draw(20 \, 20) \; grayImage:draw(360 \, 20) \; grayBg:draw(20 \, 280) \; grayDiff:draw(360 \, 280) \; ofSetHexColor(0x333333) \; ofDrawRectangle(360 \, 540 \, 320 \, 240) \; ofSetHexColor(0xffffff) \; contourFinder:draw(360 \, 540) \; end \; \; function a.mousePressed() \; grayBg:setFromPixels(grayImage:getPixels()) \; end \; \; function a.exit() \; videoGrabber:close() \; end \;;
